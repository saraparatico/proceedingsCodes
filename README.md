# proceedingsCodes
Codes associated to the chapter "Estimation of optimal inlet boundary conditions for blood flow assessment in abdominal aortic aneurysm using variational data assimilation", which was submitted to the Proceedings of the FEniCS Conference 2024.

## Requirements & installation
This project was developed using Python 3.8.10. It is recommended to run the scripts in a Python environment compatible with this version. The development was carried out using PyCharm as the Integrated Development Environment (IDE).

For the installation of FEniCS, please refer to the official installation guide at: https://fenicsproject.org/download/archive/

## Description
This repository contains two main directories, each corresponding to different simulation setups:
- "codes_syntheticGeometries": it includes all the necessary code to run simulations on simple synthetic geometries, such as a 2D rectangular domain and a 3D cylindrical domain.
- "codes_realAAA": it is designed to run simulations on patient-specific abdominal aortic aneurysm geometries.

Both directories have a similar structure, which includes the following key files:
- "main.py": it is the core of the project and is the file to execute in both cases to run the simulations.
- "v0.json": it contains all the simulation parameters. To adjust the working conditions (e.g., switching from 2D to 3D simulations), simply modify this file. All other code files remain unchanged.
- "solver.py": it contains the solvers used for the simulations.
- "problem.py": it file defines the problem class. It is responsible for reading the mesh, defining function spaces, and including the functions that read control inputs and observations. The control and observation functions are generated by functions defined in "utils.py".

On the other hand, there is a significant difference in the input geometric and physical data between the two directories:
- In "codes_syntheticGeometries", there is a folder named "initialization-files" which contains files for generating the initial meshes. Boundary conditions and observations are synthetically generated using functions defined in "utils.py".
- In "codes_realAAA", there is a folder named "python-scripts", which contains two subfolders: "init-data" and "4DFlow-processing". The "init-data folder" includes files that allow you to convert the mesh into the required format from an input ".vtu" and ".vtp" file. The same files can also be used to generate the inlet and observation conditions with the provided codes.

## Workflow
For both directories, the following sequence of steps must be followed:
- Create/Convert the Mesh: Use the scripts in the appropriate subfolder to create or convert the mesh into the desired format.
- Generate Boundary Conditions and Observations: The boundary conditions and observations must be generated next. In "codes_syntheticGeometries", this is done using functions in "utils.py". In the Patient-Specific Geometries directory, this can be done using the provided scripts in "init-data".
- Run the Main Simulation: After the mesh and boundary conditions are set, run "main.py" to execute the simulation.

## Usage
To run the simulation, modify the "v0.json" file to set the desired parameters (e.g., geometry, simulation conditions). Then, execute "main.py". The structure is designed to allow easy adjustments for different geometries and simulation setups.

To work with the simulations, I decided to use a virtual environment. I created it using PyCharm, but then I often worked from the terminal, following these steps:
- Creation of a Virtual Environment using Pycharm
- Once the virtual environment is created, you can activate it by navigating to the folder containing the environment and running:
bash: "source /path/to/folder/bin/activate"
- To deactivate the virtual environment, simply run:
bash: "deactivate"
- Inside the virtual environment, I typically used MPI (Message Passing Interface) to launch simulations, as follows:
bash: "mpirun -n 12 python3 main.py --v 0"
This command utilizes 12 processors on a workstation equipped with 24 CPU cores and 64 GB of RAM.

However, this was my preferred setup for running simulations and you are free to choose the method that best suits your needs, whether you prefer to use fewer processors or run the simulation without MPI support.
